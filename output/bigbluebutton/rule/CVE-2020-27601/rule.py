import sys
import re
import json

def detect_vulnerability(file_path):
    try:
        with open(file_path, 'r', encoding='utf-8') as file:
            content = file.read()
    except:
        return []
    
    pattern = r"Meetings\.findOne\(\s*{[^}]*}\s*,\s*{\s*fields:\s*{\s*'lockSettingsProps\.disablePublicChat':\s*1\s*}\s*}\)"
    
    lines = content.split('\n')
    results = []
    
    for line_num, line in enumerate(lines, 1):
        if re.search(pattern, line):
            results.append({
                "loc": str(line_num),
                "reason": "Missing 'disablePrivateChat' field in lockSettingsProps query for private chat validation"
            })
    
    return results

if __name__ == "__main__":
    if len(sys.argv) < 2:
        print("[]")
        sys.exit(1)
    
    file_path = sys.argv[1]
    vulnerabilities = detect_vulnerability(file_path)
    print(json.dumps(vulnerabilities, indent=2))